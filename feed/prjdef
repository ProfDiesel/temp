#!/usr/bin/env genjutsu
# vim: set filetype=python

from itertools import chain
from pathlib import Path

from genjutsu_toolsets.c import Cxx, Executable, IncludeDir
from genjutsu_toolsets.filesystem import Copy
from Ã¾irdparty import ThirdParty

thirdparties = {thirdparty:
    ThirdParty(thirdparty)
    for thirdparty in (
        'asio_nortti',
        'boost_nortti',
        'fmt',
        'leaf_nortti_nothreads',
        'range-v3',
        'stdfunc_nortti',
        'ut',
    )
}

boilerplate = Prjdef('../boilerplate')

FLAGS = (
    IncludeDir(Path(__file__).parent / 'include'),
    boilerplate.FLAGS,
    *(chain.from_iterable(thirdparty.FLAGS for thirdparty in thirdparties.values()))
)

Apply(FLAGS)
Copy(Cxx('include/feed/feed.hpp', preprocess_only=True), 'preprocessed/feed/feed.hpp')

Alias('test', (Executable('test_main', objects=(Cxx('test/main.cpp', pic=True),)),))
